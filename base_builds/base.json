{
  "variables": {
    "osfamily": "debian",
    "script_file_ext": "sh",
    "image_base_name": "debian_7_base",
    "aws_base_source": "ami-1d61a76a",
    "aws_region": "eu-west-1",
    "rackspace_base_source": "11b0cefc-d4ec-4f09-9ff6-f842ca97987c",
    "rackspace_region": "LON",
    "rackspace_provider": "rackspace-uk",
    "vbox_guest_os_type": "Debian_64",
    "vbox_iso_url": "http://cdimage.debian.org/debian-cd/7.6.0/amd64/iso-cd/debian-7.6.0-amd64-netinst.iso",
    "vbox_iso_checksum": "8a3c2ad7fd7a9c4c7e9bcb5cae38c135",
    "vbox_iso_checksum_type": "md5",
    "vbox_ssh_username": "root",
    "vbox_ssh_password": "password"
  },
  "builders": [
    {
      "type": "amazon-ebs",
      "region": "{{ user `aws_region` }}",
      "source_ami": "{{ user `aws_base_source` }}",
      "instance_type": "t1.micro",
      "ssh_username": "admin",
      "ami_name": "{{ user `image_base_name` }}_{{timestamp}}"
    },
    {
      "type": "openstack",
      "openstack_provider": "rackspace",
      "provider": "{{ user `rackspace_provider` }}",
      "region": "{{ user `rackspace_region` }}",
      "source_image": "{{ user `rackspace_base_source` }}",
      "flavor": "1",
      "ssh_username": "root",
      "image_name": "{{ user `image_base_name` }}_{{timestamp}}"
    },
    {
      "type": "virtualbox-iso",
      "iso_url": "{{ user `vbox_iso_url` }}",
      "iso_checksum": "{{ user `vbox_iso_checksum` }}",
      "iso_checksum_type": "{{ user `vbox_iso_checksum_type` }}",
      "guest_os_type": "{{ user `vbox_guest_os_type` }}",
      "disk_size": 8192,
      "boot_command": ["<esc> auto url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/{{ user `image_base_name` }}.cfg locale=en_GB.UTF-8 keymap=gb<enter><wait>"],
      "ssh_username": "{{ user `vbox_ssh_username` }}",
      "ssh_password": "{{ user `vbox_ssh_password` }}",
      "ssh_wait_timeout": "10000s",
      "headless": "false",
      "shutdown_command": "sudo shutdown -hP now",
      "http_directory": "http",
      "guest_additions_mode": "upload"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "scripts": [
          "scripts/base_{{ user `osfamily` }}.{{ user `script_file_ext` }}"
      ],
      "override": {
        "virtualbox-iso": {
          "scripts": [
            "scripts/vbox_{{ user `osfamily` }}.{{ user `script_file_ext` }}"
          ]
        }
      }
    }
  ]
}